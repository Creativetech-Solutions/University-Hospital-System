AUI.add("aui-editor-bbcode-plugin",function(q){var e=q.Lang,m=e.isArray,n=e.isString,j=q.getClassName,i="bbcodeplugin",p="bbcode",l="quote",v=l,o=v+"-content",x=v+"-title",r="\\[(({0})=([^\\]]*))\\]([\\s\\S]*?)\\[\\/{0}\\]",t="\\[({0})\\]([\\s\\S]*?)\\[\\/{0}\\]",d="<{0}(>|\\b[^>]*>)([\\s\\S]*?)</{0}>",f="<(([a-z0-9]+)\\b[^>]*?style=(\"|').*?{0}\\s*:\\s*([^;\"']+);?[^>]*)>([\\s\\S]*?)<(/\\2)>",h="(<[a-z0-9]+[^>]*>|</[a-z0-9]+>)",k='<div class="'+v+'"><div class="'+o+'">',g="</div></div>",c='<div class="'+x+'">$1</div>'+k,s=new RegExp(h,"gi"),u=[{convert:[["br"]],regExp:"<{0}[^>]*>",output:"\n"},{convert:[["&nbsp;"]],regExp:"{0}",output:" "},{convert:[{tags:["font-family"],source:["font"]},{tags:["font-size"],source:["size"]},{tags:["[^a-z-]*color"],source:["color"]}],regExp:f,output:"<$1>[{0}=$4]$5[/{0}]<$6>"},{convert:[{tags:["font-style"],source:["i"]},{tags:["font-weight"],source:["b"]}],regExp:f,output:"<$1>[{0}]$5[/{0}]<$6>"},{convert:[["text-decoration"]],regExp:f,output:function(){var z="";var y=arguments[4].toLowerCase();if(y.indexOf("underline")!=-1){z+="[u]";}else{if(y.indexOf("line-through")!=-1){z+="[s]";}}if(z!=""){return"<"+arguments[1]+">"+z+arguments[5]+z.replace("[","[/")+"<"+arguments[6]+">";}return arguments[0];}},{convert:[["margin-left"]],regExp:f,output:function(){var z="";var A=parseInt(arguments[3],10);if(!isNaN(A)){var B=Math.floor(A/40);for(var y=0;y<B;y++){z+="[indent]";}}z=z+arguments[5]+z.replace(/\[/g,"[/");return"<"+arguments[1]+">"+z+"<"+arguments[6]+">";}},{convert:[{tags:["font","size"],source:["size"]},{tags:["font","face"],source:["font"]}],regExp:"(<{0}\\b[^>]*{1}=(\"|')([^\"']+)(\"|')[^>]*>)([\\s\\S]*?)(</{0}>)",output:"$1[{0}=$3]$5[/{0}]$6"},{convert:[["text-align"]],regExp:f,output:"<$1>[$4]$5[/$4]<$6>"},{convert:[["quote"]],regExp:"<div\\b[^>]*class=(\"|')([^\"']*?)_"+v+"[^\"']*(\"|')[^>]*>([\\s\\S]*?)</div>",output:"$4"},{convert:[["span"]],regExp:d,output:"$2"},{convert:[["blockquote"]],regExp:d,output:"[indent]$2[/indent]"},{convert:[["b"],["strong"]],regExp:d,output:"[b]$2[/b]"},{convert:[["i"],["em"]],regExp:d,output:"[i]$2[/i]"},{convert:[["u"]],regExp:d,output:"[u]$2[/u]"},{convert:[["s"],["strike"]],regExp:d,output:"[s]$2[/s]"},{convert:[["img"]],regExp:"(<a[^>]*>)?<{0}\\b[^>]*src=(\"|')([^\"']+)(\"|')[^>]*>(</a>)?",output:"[img]$3[/img]"},{convert:[["a"]],regExp:"<{0}\\b[^>]*href=(\"|')mailto:([^\"']+)(\"|')[^>]*>([\\s\\S]*?)</{0}>",output:"[email=$2]$4[/email]"},{convert:[["a"]],regExp:"<{0}\\b[^>]*href=(\"|')([^\"']+)(\"|')[^>]*>([\\s\\S]*?)</{0}>",output:"[url=$2]$4[/url]"},{convert:[["center"]],regExp:d,output:"[center]$2[/center]"},{convert:[["ul"]],regExp:d,output:"[list]$2[/list]"},{convert:[["ol"]],regExp:d,output:"[list=1]$2[/list]"},{convert:[["li"]],regExp:d,output:"[*]$2"},{convert:[["code"]],regExp:d,output:"[code]$2[/code]"},{convert:[["div"]],regExp:d,output:"$2\n"},{convert:[["h1"],["h2"],["h3"],["h4"],["h5"],["h6"]],regExp:d,output:"[b]$2[/b]\n"},{convert:[["p"]],regExp:d,output:"\n$2\n"},{convert:[{tags:["list","left|center|right"],source:["list"]}],regExp:"(\\[{0}[^\\]]*\\])\\s*\\[({1})\\]([\\s\\S]*?)\\[/\\2\\]\\s*\\[/{0}\\]",output:"[$2]$1$3[/{0}][/$2]"}],b=[{convert:[{tags:["b"],source:["b"]},{tags:["i"],source:["i"]},{tags:["u"],source:["u"]},{tags:["s"],source:["s"]},{tags:["code"],source:["code"]}],regExp:t,output:"<{0}>$2</{0}>"},{convert:[{tags:["color"],source:["color"]}],regExp:r,output:'<span style="{0}: $3;">$4</span>'},{convert:[{tags:["font"],source:["face"]},{tags:["size"],source:["size"]}],regExp:r,output:'<font {0}="$3">$4</font>'},{convert:[["img"]],regExp:t,output:'<img src="$2" alt="" />'},{convert:[{tags:["email"],source:["mailto:"]},{tags:["url"],source:[""]}],regExp:r,output:'<a href="{0}$3">$4</a>'},{convert:[["list"]],regExp:"\\[({0}(=1)?)]([\\s\\S]*?)\\[\\/{0}\\]",output:function(){var A="";if(arguments[1]=="list=1"){A+="<ol>";}else{A+="<ul>";}var y=e.trim(arguments[3]).split("[*]");for(var z=1;z<y.length;z++){A+="<li>"+y[z]+"</li>";}if(arguments[1]=="list=1"){A+="</ol>";}else{A+="</ul>";}return A;}},{convert:[{tags:["indent"],source:["blockquote"]}],regExp:t,output:"<{0}>$2</{0}>"},{convert:[["left"],["center"],["right"]],regExp:t+"\n?",output:'<div style="text-align: $1;">$2</div>'},{convert:[["\n"]],regExp:"{0}",output:"<br />"}];var w={};w[l]={children:[{icon:"quote",_titleKey:"QUOTE"}]};q.mix(q.Plugin.ExecCommand.COMMANDS,{quote:function(B,C){var y=this;var A=y.get("host");var z=k+"{0}"+g;A.execCommand("wraphtml",z);A.focus();}});if(!YUI.AUI.defaults.EditorToolbar){YUI.AUI.defaults.EditorToolbar={STRINGS:{}};}q.mix(YUI.AUI.defaults.EditorToolbar.STRINGS,{QUOTE:"Quote"});var a=q.Component.create({NAME:i,NS:p,EXTENDS:q.Plugin.Base,ATTRS:{host:{value:false}},prototype:{initializer:function(){var y=this;var z=y.get("host");z.addGroupType(l,w[l]);y.afterHostMethod("getContent",y.getBBCode,y);z.on("contentChange",y._contentChange,y);},getBBCode:function(){var y=this;var B=y.get("host");var C=B.getInstance();var D=C.one("body").cloneNode(true);var z;var A=function(M,G,E){var H;var L=M;do{if(L){H=L;}L=L.one("div."+o);}while(L);var K=H.get("parentNode");if(K.hasClass(l)){var J=K.previous();var I="["+l;if(J&&J.hasClass(x)){var F=J.get("innerHTML");F=F.replace(s,"");I+="="+(F.charAt(F.length-1)==":"?F.substring(0,F.length-1):J.get("innerHTML"));J.remove(true);}I+="]"+H.get("innerHTML")+"[/"+l+"]\n";K.set("innerHTML",I);K.removeClass(l);K.addClass("_"+l);}};while(z=D.all("div."+v)){if(!z.size()){break;}z.each(A);}html=D.get("innerHTML");html=y._parseTagExpressions(u,html);html=html.replace(s,"");return new q.Do.AlterReturn(null,html);},getContentAsHtml:function(){var y=this;var z=y.get("host");return z.constructor.prototype.getContent.apply(z,arguments);},setContentAsBBCode:function(z){var y=this;var A=y.get("host");A.set("content",z);},_contentChange:function(z){var y=this;z.newVal=y._parseBBCode(z.newVal);z.stopImmediatePropagation();},_parseBBCode:function(z){var y=this;var A=z;A=A.replace(/\[quote=([^\]]*)\]/gi,c);
A=A.replace(/\[quote\]/gi,k);A=A.replace(/\[\/quote\]\n?/gi,g);A=y._parseTagExpressions(b,A);return A;},_parseTagExpressions:function(I,E){var H=this;var D;var G;var y;var z;var J;for(var C=0;C<I.length;C++){D=I[C];G=D.convert;z=G.length;for(var B=0;B<z;B++){var A=D.output;y=G[B];if(m(y)){J=y;}else{J=y.tags;if(n(A)){A=e.sub(A,y.source);}}var F=e.sub(D.regExp,J);E=E.replace(new RegExp(F,"gi"),A);}}return E;}}});q.namespace("Plugin").EditorBBCode=a;},"@VERSION@",{requires:["aui-base","editor-base"]});