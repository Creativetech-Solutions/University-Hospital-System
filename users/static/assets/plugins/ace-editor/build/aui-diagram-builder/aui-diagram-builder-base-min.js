AUI.add("aui-diagram-builder-base",function(ai){var X=ai.Lang,d=X.isArray,ay=X.isBoolean,O=X.isNumber,F=X.isObject,aC=X.isString,M=function(A){return ai.instanceOf(A,ai.ArrayList);},V=function(A){return ai.instanceOf(A,ai.Node);},H=function(A){return ai.instanceOf(A,ai.AvailableField);},aL=ai.Array,Y="add",o="addNode",aK="auto",P="availableField",T="availableFields",aH="availableFieldsDragConfig",v="boundingBox",aE="builder",ac="cancel",af="canvas",aA="clearfix",f="column",a="container",ag="content",y="contentBox",e="contentContainer",S="contentNode",I="createDocumentFragment",D="diagram",ap="diagram-builder",ad="disk",r="draggable",aG="drop",at="dropConfig",ab="dropContainer",ax="field",w="fields",q="fieldsContainer",aw="height",s="helper",aa="icon",z="iconClass",ar="id",am="label",x="layout",aq="list",R="maxFields",u="node",g="parentNode",ah="propertyList",aF="rendered",au="save",t="settings",Q="tab",K="tabView",b="tabs",h="tabview",an="title",N="toolbar",m="toolbarContainer",C=ai.getClassName,aJ=" ",i=".",j="#",aJ=" ",E="_",n=C(f),B=C(D,aE,af),aj=C(D,aE,ag,a),G=C(D,aE,aG,a),az=C(D,aE,ax),l=C(D,aE,ax,r),c=C(D,aE,ax,aa),ae=C(D,aE,ax,am),Z=C(D,aE,w,a),ak=C(D,aE,Q,Y),L=C(D,aE,Q,t),av=C(D,aE,b),U=C(D,aE,b,ag),ao=C(D,aE,N,a),al=C(s,aA),p=C(aa),J=C(x),aD=C(h,ag),aI=C(h,aq);var k=ai.Component.create({NAME:P,ATTRS:{draggable:{value:true,validator:ay},label:{validator:aC},iconClass:{validator:aC},id:{value:ai.guid(),setter:"_setId",validator:aC},node:{valueFn:function(aM){var A=this;if(!V(aM)){aM=ai.Node.create(ai.Lang.sub(A.FIELD_ITEM_TEMPLATE,{iconClass:A.get(z)}));aM.setData(P,A);}return aM;},validator:V,writeOnce:true},type:{value:u,validator:aC}},EXTENDS:ai.Base,buildNodeId:function(A){return T+E+ax+E+A;},getAvailableFieldById:function(A){return ai.AvailableField.getAvailableFieldByNode(j+ai.AvailableField.buildNodeId(A));},getAvailableFieldByNode:function(A){var A=ai.one(A);if(V(A)){return A.getData(P);}return null;},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+az+'">'+'<span class="'+[p,c].join(aJ)+' {iconClass}"></span>'+'<div class="'+ae+'"></div>'+"</li>",initializer:function(){var A=this;var aM=A.get(u);A.after({draggableChange:A._afterDraggableChange,idChange:A._afterIdChange,labelChange:A._afterLabelChange});A.labelNode=aM.one(i+ae);A._uiSetDraggable(A.get(r));A._uiSetId(A.get(ar));A._uiSetLabel(A.get(am));},_afterDraggableChange:function(aM){var A=this;A._uiSetDraggable(aM.newVal);},_afterIdChange:function(aM){var A=this;A._uiSetId(aM.newVal);},_afterLabelChange:function(aM){var A=this;A._uiSetLabel(aM.newVal);},_setId:function(A){return ai.AvailableField.buildNodeId(A);},_uiSetDraggable:function(aM){var A=this;A.get(u).toggleClass(l,aM);},_uiSetId:function(aM){var A=this;A.get(u).set(ar,aM);},_uiSetLabel:function(aM){var A=this;A.get(u).attr(an,aM);A.labelNode.setContent(ai.Escape.html(aM));}}});ai.AvailableField=k;var W=function(){};W.ATTRS={fields:{value:[],setter:"_setFields",validator:function(A){return d(A)||M(A);}},maxFields:{value:Infinity,validator:O}};ai.mix(W.prototype,{_setFields:function(aM){var A=this;if(M(aM)){return aM;}else{return A.createFields(aM);}},_updateFields:function(aM){var A=this;A.set(w,aM);},addField:function(aN,aM){var A=this;if(A.get(w).size()<A.get(R)){var aO=A.createField(aN);if(aO){A._updateFields(A.get(w).add(aO,aM));}return aO;}return null;},createFields:function(aN){var aM=this;var A=[];aL.each(aN,function(aP,aO){if(aO<aM.get(R)){A.push(aM.createField(aP));}});return new ai.ArrayList(A);},removeField:function(aM){var A=this;A._updateFields(A.get(w).remove(aM));},createField:function(A){return A;}});ai.FieldSupport=W;var aB=ai.Component.create({NAME:ap,ATTRS:{availableFields:{setter:"_setAvailableFields",validator:d},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:F},canvas:{valueFn:function(){return ai.Node.create(this.CANVAS_TEMPLATE);}},dropConfig:{value:null,setter:"_setDropConfig",validator:F},contentContainer:{valueFn:function(){return ai.Node.create(this.CONTENT_CONTAINER_TEMPLATE);}},dropContainer:{valueFn:function(){return ai.Node.create(this.DROP_CONTAINER_TEMPLATE);}},fieldsContainer:{valueFn:function(){return ai.Node.create(this.FIELDS_CONTAINER_TEMPLATE);}},propertyList:{setter:"_setPropertyList",validator:F,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},tabView:{setter:"_setTabView",validator:F,value:null,writeOnce:true},toolbar:{setter:"_setToolbar",validator:F,value:null},toolbarContainer:{valueFn:function(){return ai.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE);}}},HTML_PARSER:{contentContainer:i+aj,dropContainer:i+G,fieldsContainer:i+Z,toolbarContainer:i+ao,canvas:i+B},UI_ATTRS:[T,w],AUGMENTS:[ai.FieldSupport],prototype:{CONTENT_CONTAINER_TEMPLATE:'<div class="'+aj+'"></div>',DROP_CONTAINER_TEMPLATE:'<div class="'+G+'"></div>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+ao+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+[Z,al].join(aJ)+'"></ul>',CANVAS_TEMPLATE:'<div tabindex="1" class="'+B+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn}});A.after({render:A._afterRender,"recordset:update":A._afterRecordsetUpdate});A.after(A._afterUiSetHeight,A,"_uiSetHeight");A.canvas=A.get(af);A.contentContainer=A.get(e);A.dropContainer=A.get(ab);A.fieldsContainer=A.get(q);A.toolbarContainer=A.get(m);},isAvailableFieldsDrag:function(aN){var A=this;var aM=A.availableFieldsDrag;return(aN===aM.dd);},plotFields:function(){var aM=this;var A=aM.get(w);A.each(function(aN){aM.plotField(aN);});},renderUI:function(){var A=this;A._renderTabs();A._renderCanvas();A._uiSetAvailableFields(A.get(T));},syncUI:function(){var A=this;var aM=A.get(y);A._setupDrop();A._setupAvailableFieldsDrag();aM.addClass(J);},_afterActiveTabChange:function(aN){var A=this;var aM=aN.newVal.get(S);if(A.get(aF)&&(aM===A.settingsNode)){A._renderSettings();
}},_afterRecordsetUpdate:function(aM){var A=this;A._handleSaveEvent();},_afterRender:function(aM){var A=this;A.plotFields();},_afterUiSetHeight:function(aM){var A=this;A.contentContainer.setStyle(aw,O(aM)?aM+A.DEF_UNIT:aM);A.dropContainer.setStyle(aw,O(aM)?aM+A.DEF_UNIT:aM);},_defCancelFn:function(aM){var A=this;A.tabView.selectTab(0);},_handleCancelEvent:function(){var A=this;A.fire(ac);},_handleSaveEvent:function(){var A=this;A.fire(au);},_renderCanvas:function(){var A=this;var aM=A.get(y);var aN=A.canvas;var aO=A.contentContainer;var aP=A.dropContainer;if(!aN.inDoc()){aO.appendChild(aN);}if(!aP.inDoc()){aN.appendChild(aP);}if(aO.inDoc()){aO.get(g).append(aO);}else{aM.appendChild(aO);}},_renderPropertyList:function(){var A=this;if(!A.propertyList){A.propertyList=new ai.PropertyList(A.get(ah)).render(A.settingsNode);A.propertyList.get(v).unselectable();}},_renderSettings:function(){var A=this;A._renderPropertyList();A._renderToolbar();},_renderTabs:function(){var A=this;if(!A.tabView){var aM=new ai.TabView(A.get(K));aM.get(v);A.tabView=aM;A.fieldsNode=aM.getTab(0).get(S);A.settingsNode=aM.getTab(1).get(S);}},_renderToolbar:function(){var A=this;if(!A.toolbar){A.toolbar=new ai.Toolbar(A.get(N)).render(A.settingsNode);}},_setupDrop:function(){var A=this;A.drop=new ai.DD.Drop(A.get(at));},_setupAvailableFieldsDrag:function(){var A=this;A.availableFieldsDrag=new ai.DD.Delegate(A.get(aH));},_setAvailableFields:function(aN){var aM=this;var A=[];aL.each(aN,function(aP,aO){A.push(H(aP)?aP:new ai.AvailableField(aP));});return A;},_setDropConfig:function(aM){var A=this;return ai.merge({bubbleTargets:A,groups:[T],node:A.dropContainer},aM||{});},_setAvailableFieldsDragConfig:function(aM){var A=this;return ai.merge({bubbleTargets:A,container:A.get(v),dragConfig:{groups:[T],plugins:[{cfg:{moveOnEnd:false},fn:ai.Plugin.DDProxy}]},nodes:i+l},aM||{});},_setPropertyList:function(aM){var A=this;return ai.merge({bubbleTargets:A,width:250,scroll:{height:400,width:aK}},aM);},_setTabView:function(aP){var aM=this;var aO=aM.get(v);var aQ=aO.one(i+aI);var aN={after:{activeTabChange:ai.bind(aM._afterActiveTabChange,aM)},boundingBox:aO.one(i+av),contentBox:aO.one(i+U),bubbleTargets:aM,contentNode:aO.one(i+aD),cssClass:av,listNode:aQ,render:aM.get(y)};if(!aQ){var A=aM.getStrings();aN.items=[{cssClass:ak,label:A[o]},{cssClass:L,label:A[t]}];}return ai.merge(aN,aP);},_setToolbar:function(aN){var aM=this;var A=aM.getStrings();return ai.merge({activeState:false,bubbleTargets:aM,children:[{handler:ai.bind(aM._handleCancelEvent,aM),label:A[ac]}]},aN);},_uiSetAvailableFields:function(aO){var A=this;var aN=A.fieldsNode;if(aN){var aM=ai.getDoc().invoke(I);aL.each(aO,function(aP){aM.appendChild(aP.get(u));});aN.setContent(A.fieldsContainer.setContent(aM));}},_uiSetFields:function(aM){var A=this;if(A.get(aF)){A.plotFields();}}}});ai.DiagramBuilderBase=aB;},"@VERSION@",{requires:["aui-tabs","aui-property-list","collection","dd"],skinnable:true});