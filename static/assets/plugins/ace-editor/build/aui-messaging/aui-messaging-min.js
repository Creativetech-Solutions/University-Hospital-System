AUI.add("aui-messaging",function(d){var j=d.Lang,c=j.isString,g,b=d.Env,e=AUI.Env,a=d.config.win,f=a.location,o=!!(a.postMessage),i="_A=",l="=A_",n=".*?",k=l+"\\d+&",m=new RegExp(k+"("+n+")"+i),h=new RegExp(k+n+i);fnPostMessage=function(t,q,v){if(q){if(j.isObject(t)){t=d.QueryString.stringify(t);}try{v=d.one(v);v=v&&v.getDOM().contentWindow;}catch(u){}v=v||a.parent;if(o){q=q.replace(/([^:]+:\/\/[^\/?]+).*/,"$1");v.postMessage(t,q);}else{var p=q.split("#");var s=p[1]||"";s=s.replace(h,"");var r=j.now()+(++b._uidx);s=(l+r+"&"+t+i)+s;p[1]=s;v.location=p.join("#");}}};fnReceiveMessage=function(u,t,q){if(o){var r=Messaging._callbackFn;if(r){e.remove(a,"message",r);Messaging._callbackFn=null;}if(u){var p=d.rbind(Messaging._validateCallback,Messaging,t,u);Messaging._callbackFn=p;e.add(a,"message",p);}}else{var s=Messaging._INTERVAL_ID;if(s){d.clearInterval(s);Messaging._INTERVAL_ID=null;}if(u){if(j.isUndefined(q)){q=100;if(j.isNumber(t)){q=t;}}Messaging._INTERVAL_ID=d.setInterval(Messaging._pollHash,q,Messaging,u);}}};Messaging={post:fnPostMessage,receive:fnReceiveMessage,_formatEventObject:function(q){var p=this;q.responseData=p._getResponseData(q.data);return q;},_getResponseData:function(r){var p=this;var q=r;if(q&&/\w+=\w+/.test(q)){q=d.QueryString.parse(q);}return q;},_pollHash:function(t){var p=Messaging;var s=f.hash;if(s!=g&&h.test(s)){g=s;var q=s.match(m);q=(q&&q[1])||"";var r={data:q};p._formatEventObject(r);t.call(Messaging,r);}},_validateCallback:function(s,t,u){var p=Messaging;var q=s.origin;var r=false;if(j.isFunction(t)){r=t(q);}else{if(c(t)){r=(t==q);}}if(r){p._formatEventObject(s);u.call(Messaging,s);}}};d.postMessage=fnPostMessage;d.receiveMessage=fnReceiveMessage;d.Messaging=Messaging;},"@VERSION@",{requires:["aui-base","aui-task-manager","querystring"],skinnable:false});