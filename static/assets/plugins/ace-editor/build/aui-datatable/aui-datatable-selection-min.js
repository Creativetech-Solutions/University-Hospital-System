AUI.add("aui-datatable-selection",function(B){var j=B.Lang,s=j.isBoolean,v=j.isString,G=B.getClassName,i=B.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),o="cell",m="columnset",g="columnsetChange",r="datatable",E="down",J="esc",u="focused",H="host",p="id",d="keydown",x="left",q="mousedown",D="mouseEvent",w="multiple",I="recordset",f="recordsetChange",l="return",t="right",n="row",c="select",k="selected",y="selectRow",e="tab",z="tabindex",F="tr",h="up",a=G(r,o,k),C=G(r,n,k);var b=B.Base.create("dataTableSelection",B.Plugin.Base,[],{activeColumnIndex:-1,activeRecordIndex:-1,handlerKeyDown:null,selectedCellHash:null,selectedColumnHash:null,selectedRowHash:null,initializer:function(){var A=this;A.selectedCellHash={};A.selectedColumnHash={};A.selectedRowHash={};A.publish({select:{defaultFn:A._defSelectFn}});A.afterHostEvent(A.get(D),A._afterMouseEvent);A.afterHostEvent(g,A._afterHostColumnsetChange);A.afterHostEvent(f,A._afterHostRecordsetChange);A.handlerKeyDown=B.getDoc().on(d,B.bind(A._afterKeyEvent,A));},destroy:function(){var A=this;var K=A.handlerKeyDown;if(K){K.detach();}},getActiveColumn:function(){var A=this;var K=A.get(H);return K.get(m).getColumn(A.activeColumnIndex);},getActiveRecord:function(){var A=this;var K=A.get(H);return K.get(I).getRecord(A.activeRecordIndex);},isCellSelected:function(K){var A=this;return A.selectedCellHash[K.get(p)];},isColumnSelected:function(A){},isRowSelected:function(K){var A=this;return A.selectedRowHash[K.get(p)];},select:function(K,Q){var A=this;var N=A.get(H);var P=N.get(m);var O=N.get(I);var M=P.getColumnByCell(K);var L=O.getRecordByRow(Q||K.ancestor(F));A.activeColumnIndex=P.getColumnIndex(M);A.activeRecordIndex=O.getRecordIndex(L);if(K){A.selectCell(K);}if(A.get(y)&&Q){A.selectRow(Q);}},selectCell:function(K){var A=this;if(!A.get(w)){A.unselectAllCells();}A.selectedCellHash[K.get(p)]=K;K.setAttribute(z,0).focus();K.addClass(a);},selectColumn:function(A){},selectRow:function(K){var A=this;if(!A.get(w)){A.unselectAllRows();}A.selectedRowHash[K.get(p)]=K;K.addClass(C);},toggleCell:function(K,L){var A=this;if(L||!A.isCellSelected(K)){A.selectCell(K);}else{A.unselectCell(K);}},toggleColumn:function(A,K){},toggleRow:function(L,K){var A=this;if(K||!A.isRowSelected(L)){A.selectRow(L);}else{A.unselectRow(L);}},unselectCell:function(K){var A=this;delete A.selectedCellHash[K.get(p)];K.removeAttribute(z);K.removeClass(a);},unselectColumn:function(A){},unselectRow:function(K){var A=this;delete A.selectedRowHash[K.get(p)];K.removeClass(C);},unselectAllCells:function(){var A=this;B.each(A.selectedCellHash,B.bind(A.unselectCell,A));},unselectAllColumns:function(){},unselectAllRows:function(){var A=this;B.each(A.selectedRowHash,B.bind(A.unselectRow,A));},_afterHostColumnsetChange:function(K){var A=this;A._cleanUp();},_afterHostRecordsetChange:function(K){var A=this;A._cleanUp();},_afterMouseEvent:function(K){var A=this;A._handleSelectEvent(K);},_afterKeyEvent:function(N){var A=this;var M=A.get(H);var L=A.getActiveColumn();var K=A.getActiveRecord();if(!M.get(u)||!L||!K){return;}if(M.events){M.events.updateEventPayload(M.getCellNode(K,L),N);}if(N.isNavKey()){if(N.isKey(J)){A._onEscKey(N);}else{if(N.isKey(l)){A._onReturnKey(N);}else{A._navigate(N);}}N.halt();}},_cleanUp:function(){var A=this;A.selectedCellHash={};A.selectedColumnHash={};A.selectedRowHash={};},_defSelectFn:function(K){var A=this;A.select(K.cell,K.row);},_navigate:function(K){var A=this;A._updateNavKeyInfo(K);A._handleSelectEvent(K);},_onEscKey:function(M){var A=this;var L=A.get(H);var K=L.getCellEditor(M.record,M.column);if(K){K.hide();}},_onReturnKey:function(L){var A=this;var K=A.get(H);K._editCell(L);},_handleSelectEvent:function(K){var A=this;A.fire(c,{cell:K.cell,column:K.column,inHead:K.inHead,liner:K.liner,originalEvent:K.originalEvent,row:K.row,record:K.record});},_updateNavKeyInfo:function(A){var T=this;var U=T.get(H);var K=A.originalEvent;var M=U.get(m);var Q=A.column.keyIndex;var S=U.get(I);var N=S.getRecordIndex(A.record);var L=K.ctrlKey||K.metaKey;var R=K.shiftKey;if(K.isKey(x)||(R&&K.isKey(e))){if(L){Q=0;}else{Q--;}}else{if(K.isKey(t)||(!R&&K.isKey(e))){if(L){Q=M.getLength()-1;}else{Q++;}}else{if(K.isKey(E)){if(L){N=S.getLength()-1;}else{N++;}}else{if(K.isKey(h)){if(L){N=0;}else{N--;}}}}}Q=Math.max(Math.min(Q,M.getLength()-1),0);N=Math.max(Math.min(N,S.getLength()-1),0);if(U.events){var O=M.getColumn(Q);var P=S.getRecord(N);U.events.updateEventPayload(U.getCellNode(P,O),A);}},_setMouseEvent:function(A){return o+i(A);}},{NS:"selection",NAME:"dataTableSelection",ATTRS:{selectRow:{value:false,validator:s},multiple:{value:false,validator:s},mouseEvent:{setter:"_setMouseEvent",value:q,validator:v}}});B.namespace("Plugin").DataTableSelection=b;},"@VERSION@",{requires:["aui-datatable-base"],skinnable:true});