AUI.add("aui-form-builder-base",function(br){var bk=br.Lang,aA=bk.isArray,aC=bk.isBoolean,bh=bk.isString,bP=bk.isObject,ac=bk.isValue,bM=br.Array,bR=br.AvailableField.getAvailableFieldById,e=function(A){return(A instanceof br.AvailableField);},aY=function(A){return(A instanceof br.Node);},aH=function(A){return(A instanceof br.NodeList);},bQ=function(A){return(A instanceof br.FormBuilder);},bg=function(A){return(A instanceof br.FormBuilderField);},a0=br.DD.DDM,d="acceptChildren",bm="active",aX="allowRemoveRequiredFields",H="add",bJ="append",o="autoSelectFields",bv="availableField",bO="availableFields",X="base",ax="boundingBox",bz="builder",bE="button",z="buttons",s="buttonsNode",i="children",bj="click",al="cloneNode",az="component",at="container",ar="content",bL="contentBox",aZ="data",ad="dblclick",Y="dd",bD="default",ag="defaultMessage",B="defaultMessageNode",aB="delete",j="diagram",bb=".",aL="drag",am="dragContainer",r="dragContainerNode",bn="dragNodesList",bc="draggable",n="dragging",ai="drop",aR="dropContainer",aU="dropContainerNode",bu="dropNode",aF="dropZoneNode",ao="duplicate",C="edit",bG="editing",bd="emptySelection",a6="",bt="enableEditing",aV="field",c="fields",D="fieldsNestedListConfig",aj="first",m="firstChild",P="focused",k="form",aO="formBuilder",Q="form-layout",h="helper",aa="hidden",bs="hiddenAttributes",l="icon",bB="id",bK="inactive",by="index",aE="input",b="items",bS="key",R="label",bp="labelNode",av="last",aI="lastChild",af="list",aJ="localizationMap",aW="message",be="mouseenter",w="mouseleave",ak="name",a3="nestedList",bT="node",N="options",aK="over",ah="parent",G="parentNode",S="placeAfter",y="placeBefore",bq="placeholder",au="predefinedValue",aN="prepend",bw="readOnlyAttributes",a8="records",bA="recordset",T="region",bN="remove",t="render",ay="rendered",W="required",ba="save",aP="selected",aD="settings",aT="settingsButtonsNode",Z="settingsFormNode",I="showLabel",J=" ",aQ="srcNode",a5="state",bl="strings",aM="tabs",U="tabsContentNode",a2="tabsListNode",a="tabsNode",bF="tabview",p="target",M="templateNode",a7="text",q="tip",K="type",an="unique",f="value",E="values",aS="widget",a1="width",bi="zone",g=",",bI="-",ab=".",x="",bo="#",aG="_",v=br.getClassName,bf=bO+aG+aV+aG,bx=c+aG+aV+aG,O=v(Y,n),bH=v(j,bz,ai,at),bC=v(j,bz,aV,bc),V=v(k,bz,ai,bi),a9=v(k,bz,aV),aq=v(k,bz,aV,bG),u=v(k,bz,bq),a4=v(k,bz,an),ap=[bB,ak],ae='<div class="'+u+'"></div>';var F=br.Component.create({NAME:bv,ATTRS:{hiddenAttributes:{value:[],validator:aA},name:{value:x},options:{validator:bP},predefinedValue:{value:x},readOnlyAttributes:{value:[],validator:aA},required:{validator:aC,value:false},showLabel:{validator:aC,value:true},tip:{validator:bh,value:x},unique:{value:false,validator:aC},width:{}},EXTENDS:br.AvailableField});br.FormBuilderAvailableField=F;var aw=br.Component.create({NAME:aO,ATTRS:{allowRemoveRequiredFields:{validator:aC,value:false},autoSelectFields:{value:false},enableEditing:{value:true},fieldsNestedListConfig:{setter:"_setFieldsNestedListConfig",validator:bP,value:null},strings:{value:{addNode:"Add field",cancel:"Cancel",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}}},UI_ATTRS:[aX],EXTENDS:br.DiagramBuilderBase,FIELDS_TAB:0,SETTINGS_TAB:1,prototype:{uniqueFields:new br.DataSet(),initializer:function(){var A=this;A.on({cancel:A._onCancel,"drag:end":A._onDragEnd,"drag:start":A._onDragStart,"drag:mouseDown":A._onDragMouseDown,save:A._onSave});A.uniqueFields.after(H,br.bind(A._afterUniqueFieldsAdd,A));A.uniqueFields.after(bN,br.bind(A._afterUniqueFieldsRemove,A));A.dropContainer.delegate(bj,br.bind(A._onClickField,A),ab+a9);A.dropContainer.delegate(ad,br.bind(A._onDblClickField,A),ab+a9);},syncUI:function(){var A=this;A._setupAvailableFieldsNestedList();A._setupFieldsNestedList();},closeEditProperties:function(){var A=this;var L=A.editingField;A.tabView.selectTab(br.FormBuilder.FIELDS_TAB);if(L&&L.get(ay)){L.get(ax).removeClass(aq);}A.editingField=null;},createField:function(L){var A=this;if(!bg(L)){L=new (A.getFieldClass(L.type||aV))(L);}L.set(bz,A);L.set(ah,A);return L;},duplicateField:function(bU){var A=this;var L=A._getFieldNodeIndex(bU.get(ax));var bV=A._cloneField(bU,true);A.insertField(bV,++L,bU.get(ah));},editField:function(L){var A=this;if(bg(L)){A.closeEditProperties();A.tabView.selectTab(br.FormBuilder.SETTINGS_TAB);A.propertyList.set(bA,[{}]);A.propertyList.set(bA,A.getFieldProperties(L));L.get(ax).addClass(aq);A.editingField=A.selectedField=L;}},getFieldClass:function(bU){var A=this;var L=br.FormBuilder.types[bU];if(L){return L;}else{br.log("The field type: ["+bU+"] couldn't be found.");return null;}},getFieldProperties:function(L){var A=this;return L.getProperties();},insertField:function(bV,L,bU){var A=this;bU=bU||A;bV.get(ah).removeField(bV);bU.addField(bV,L);},plotField:function(bV,L){var A=this;var bU=bV.get(ax);if(!bV.get(ay)){bV.render(L);}else{L.append(bU);}A._syncUniqueField(bV);A.fieldsNestedList.add(bU);},plotFields:function(L,bU){var A=this;bU=bU||A.dropContainer;L=L||A.get(c);bU.setContent(a6);br.each(L,function(bV){A.plotField(bV,bU);});},select:function(L){var A=this;A.unselectFields();A.selectedField=L.set(aP,true).focus();},unselectFields:function(){var A=this;var L=A.selectedField;if(L){L.set(aP,false);}A.selectedField=null;},_afterUniqueFieldsAdd:function(bU){var A=this;var bV=bU.attrName;if(e(bV)){var L=bV.get(bT);bV.set(bc,false);L.unselectable();}},_afterUniqueFieldsRemove:function(bU){var A=this;var bV=bU.attrName;if(e(bV)){var L=bV.get(bT);bV.set(bc,true);L.selectable();}},_cloneField:function(bV,L){var A=this;var bU={};bM.each(A.getFieldProperties(bV),function(bX){var bW=bX.attributeName;if(bM.indexOf(ap,bW)===-1){bU[bW]=bX.value;}});if(L){bU[c]=[];br.each(bV.get(c),function(bX,bW){if(!bX.get(an)){bU[c][bW]=A._cloneField(bX,L);}});}return A.createField(bU);},_dropField:function(bX){var L=this;var bZ=bX.getData(bv);var bY=br.Widget.getByNode(bX);var A=bX.get(G);if(e(bZ)){var bV={hiddenAttributes:bZ.get(bs),label:bZ.get(R),localizationMap:bZ.get(aJ),options:bZ.get(N),predefinedValue:bZ.get(au),readOnlyAttributes:bZ.get(bw),required:bZ.get(W),showLabel:bZ.get(I),tip:bZ.get(q),type:bZ.get(K),unique:bZ.get(an),width:bZ.get(a1)};
if(bV.unique){bV.id=L._getFieldId(bZ);bV.name=bZ.get(ak);}bY=L.createField(bV);}if(bg(bY)){var bW=br.Widget.getByNode(A);if(!bg(bW)){bW=L;}var bU=L._getFieldNodeIndex(bX);L.insertField(bY,bU,bW);L.select(bY);}},_getFieldId:function(bU){var A=this;var bV=bU.get(bB);var L;if(e(bU)){L=bf;}else{L=bx;}return bV.replace(L,x);},_getFieldNodeIndex:function(L){var A=this;return L.get(G).all("> *:not("+ab+u+")").indexOf(L);},_onClickField:function(L){var A=this;var bU=br.Widget.getByNode(L.currentTarget);A.select(bU);L.stopPropagation();},_onDblClickField:function(L){var A=this;if(!L.target.ancestor(ab+a9,true)){return;}var bU=br.Widget.getByNode(L.currentTarget);if(bU){A.editField(bU);}L.stopPropagation();},_onDragEnd:function(bU){var A=this;var L=bU.target;var bV=L.get(bT);A._dropField(bV);if(!bg(br.Widget.getByNode(bV))){bV.remove();L.set(bT,A._originalDragNode);}},_onDragMouseDown:function(L){var A=this;var bU=L.target.get(bT);var bV=br.AvailableField.getAvailableFieldByNode(bU);if(e(bV)&&!bV.get(bc)){L.halt();}},_onDragStart:function(bV){var A=this;var bU=bV.target;var bX=bU.get(bT);if(bg(br.Widget.getByNode(bX))){return;}A._originalDragNode=bX;var bW=bX.clone();bX.placeBefore(bW);bU.set(bT,bW);var L=bX.getData(bv);bW.setData(bv,L);bW.attr(bB,a6);bW.hide();bX.removeClass(O);bX.show();A.fieldsNestedList.add(bW);},_onSave:function(bU){var A=this;var L=A.editingField;if(L){var bV=A.propertyList.get(bA);bM.each(bV.get(a8),function(bW){var bX=bW.get(aZ);L.set(bX.attributeName,bX.value);});A._syncUniqueField(L);}},_setAvailableFields:function(bU){var L=this;var A=[];bM.each(bU,function(bW,bV){A.push(e(bW)?bW:new br.FormBuilderAvailableField(bW));});return A;},_setFieldsNestedListConfig:function(bU){var A=this;var L=A.dropContainer;return br.merge({bubbleTargets:A,dd:{groups:[bO],plugins:[{cfg:{horizontal:false,scrollDelay:150},fn:br.Plugin.DDWinScroll}]},dropCondition:function(bW){var bV=bW.drop.get(bT);var bX=br.Widget.getByNode(bV);if(bg(bX)){return true;}return false;},placeholder:br.Node.create(ae),dropOn:ab+V,sortCondition:function(bW){var bV=bW.drop.get(bT);return(bV!==A.dropContainer&&L.contains(bV));}},bU||{});},_setupAvailableFieldsNestedList:function(){var A=this;if(!A.availableFieldsNestedList){var L=A.fieldsContainer.all(ab+bC);A.availableFieldsNestedList=new br.NestedList(br.merge(A.get(D),{nodes:L}));}},_setupFieldsNestedList:function(){var A=this;if(!A.fieldsNestedList){A.fieldsNestedList=new br.NestedList(A.get(D));}},_syncUniqueField:function(bU){var A=this;var L=A.uniqueFields;var bV=bR(A._getFieldId(bU));if(e(bV)){if(bV.get(an)||bU.get(an)){L.add(bV,bU);}}},_uiSetAllowRemoveRequiredFields:function(L){var A=this;A.get(c).each(function(bU){bU._uiSetRequired(bU.get(W));});}}});br.FormBuilder=aw;br.FormBuilder.types={};},"@VERSION@",{skinnable:true,requires:["aui-base","aui-button-item","aui-data-set","aui-diagram-builder-base","aui-nested-list","aui-tabs"]});